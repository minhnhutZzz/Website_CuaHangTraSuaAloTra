<div th:replace="~{layouts/main-layout :: layout('Thanh toán thất bại - THE MONA', ~{::content})}">
  <div th:fragment="content">
    <main class="container mx-auto px-4 py-8">
      <div class="max-w-2xl mx-auto">
        <!-- Error Header -->
        <div class="text-center mb-8">
          <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-times text-4xl text-red-600"></i>
          </div>
          <h1 class="text-3xl font-bold text-red-600 mb-2">Thanh toán thất bại!</h1>
          <p class="text-gray-600">Đã xảy ra lỗi trong quá trình thanh toán. Vui lòng thử lại.</p>
        </div>

        <!-- Error Details -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-6">
          <h2 class="text-xl font-semibold text-[#2f604a] mb-4">Thông tin lỗi</h2>
          
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Mã đơn hàng:</span>
              <span class="font-semibold" th:text="${orderId}">#123456</span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">Số tiền:</span>
              <span class="font-semibold text-[#cb5439]" th:text="${totalPrice}">300.000₫</span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">Mã lỗi:</span>
              <span class="font-semibold text-red-600" th:text="${responseCode}">07</span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-gray-600">Trạng thái:</span>
              <span class="font-semibold text-red-600" th:text="${statusText}">Thanh toán thất bại</span>
            </div>
            
            <div th:if="${error}" class="flex justify-between">
              <span class="text-gray-600">Chi tiết lỗi:</span>
              <span class="font-semibold text-red-600" th:text="${error}">Lỗi xử lý thanh toán</span>
            </div>
          </div>
        </div>

        <!-- Error Status -->
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
          <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-red-600 mr-3"></i>
            <div>
              <h3 class="font-semibold text-red-800">Trạng thái thanh toán</h3>
              <p class="text-red-700" th:text="${statusText}">Thanh toán thất bại</p>
            </div>
          </div>
        </div>

        <!-- Possible Reasons -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
          <h3 class="font-semibold text-yellow-800 mb-2">Có thể do các nguyên nhân sau:</h3>
          <ul class="text-yellow-700 space-y-1">
            <li>• Thông tin thẻ không chính xác</li>
            <li>• Số dư tài khoản không đủ</li>
            <li>• Thẻ bị khóa hoặc hết hạn</li>
            <li>• Lỗi kết nối mạng</li>
            <li>• Giao dịch bị từ chối bởi ngân hàng</li>
          </ul>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4">
          <a href="/cart" class="flex-1 bg-[#2f604a] text-white py-3 px-6 rounded-lg text-center font-semibold hover:bg-[#1e3d2e] transition-colors">
            <i class="fas fa-redo mr-2"></i>
            Thử lại thanh toán
          </a>
          <a href="/products" class="flex-1 bg-gray-100 text-gray-700 py-3 px-6 rounded-lg text-center font-semibold hover:bg-gray-200 transition-colors">
            <i class="fas fa-shopping-bag mr-2"></i>
            Tiếp tục mua sắm
          </a>
        </div>

        <!-- Support Info -->
        <div class="mt-8 text-center">
          <p class="text-gray-600 mb-2">Cần hỗ trợ?</p>
          <div class="flex justify-center space-x-4">
            <a href="tel:1900123456" class="text-[#2f604a] hover:underline">
              <i class="fas fa-phone mr-1"></i>
              1900 123 456
            </a>
            <a href="mailto:support@themona.com" class="text-[#2f604a] hover:underline">
              <i class="fas fa-envelope mr-1"></i>
              support@themona.com
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
// Keep cart intact after failed payment
document.addEventListener('DOMContentLoaded', function() {
    console.log('Payment failed - cart preserved for retry');
    
    // Show notification about failed payment
    setTimeout(() => {
        if (typeof showNotification === 'function') {
            showNotification('Thanh toán thất bại! Giỏ hàng đã được giữ lại để bạn thử lại.', 'error');
        }
    }, 1000);
});
</script>
